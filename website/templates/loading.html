{% extends "base.html" %}
{% block content %}
<div class="text-center mt-5">
    <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <h3 class="mt-3">We're finding books just for you...</h3>
    <p class="text-muted" id="status-message">Initializing...</p>

    <!-- Bootstrap Progress Bar -->
    <div class="progress" style="height: 20px; width: 70%; margin: 0 auto;">
        <div class="progress-bar progress-bar-striped progress-bar-animated"
             role="progressbar"
             style="width: 0%;" id="progress-bar"
             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            0%
        </div>
    </div>
</div>

<script>
    function checkStatus() {
        fetch("{{ url_for('views.recommendation_status_check') }}")
            .then(response => response.json())
            .then(data => {
                document.getElementById("status-message").textContent = data.msg;

                const progressBar = document.getElementById("progress-bar");
                progressBar.style.width = data.progress + "%";
                progressBar.setAttribute("aria-valuenow", data.progress);
                progressBar.textContent = data.progress + "%";

                if (data.ready) {
                    window.location.href = "{{ url_for('views.books', state='watchlist') }}";
                } else {
                    setTimeout(checkStatus, 2000);
                }
            });
    }

    setTimeout(checkStatus, 1000);
</script>
{% endblock %}
